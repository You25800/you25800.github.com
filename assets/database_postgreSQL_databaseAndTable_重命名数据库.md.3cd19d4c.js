import{_ as s,o as a,c as l,R as n}from"./chunks/framework.333b51ca.js";const D=JSON.parse('{"title":"使用 PostgreSQL ALTER DATABASE 语句重命名数据库","description":"","frontmatter":{},"headers":[],"relativePath":"database/postgreSQL/databaseAndTable/重命名数据库.md","filePath":"database/postgreSQL/databaseAndTable/重命名数据库.md","lastUpdated":1689061386000}'),p={name:"database/postgreSQL/databaseAndTable/重命名数据库.md"},o=n(`<h1 id="使用-postgresql-alter-database-语句重命名数据库" tabindex="-1">使用 PostgreSQL ALTER DATABASE 语句重命名数据库 <a class="header-anchor" href="#使用-postgresql-alter-database-语句重命名数据库" aria-label="Permalink to &quot;使用 PostgreSQL ALTER DATABASE 语句重命名数据库&quot;">​</a></h1><p>本文介绍了在 PostgreSQL 中重命名一个数据库的详细步骤。</p><p>PostgreSQL 允许您使用 <code>ALTER DATABASE ... RENAME</code> 语句来重命名一个数据库。</p><h2 id="重命名数据库的注意事项" tabindex="-1">重命名数据库的注意事项 <a class="header-anchor" href="#重命名数据库的注意事项" aria-label="Permalink to &quot;重命名数据库的注意事项&quot;">​</a></h2><p>重命名数据库是一个简单的动作，但是它可能会带来一些其他的问题。如果您没有同步修改那些用到此数据库的代码，则他们可能不能正常运行。</p><p>当您打算修改一个数据库名的时候，您需要首先从整体上进行评估。然后，再决定是否进行重命名数据库。一旦您决定了要重命名一个数据库，您需要把需要同步修改的地方整理清楚。</p><h2 id="postgresql-重命名数据库语法" tabindex="-1">PostgreSQL 重命名数据库语法 <a class="header-anchor" href="#postgresql-重命名数据库语法" aria-label="Permalink to &quot;PostgreSQL 重命名数据库语法&quot;">​</a></h2><p>要重命名一个数据库，请按照下面的语法使用 <code>ALTER DATABASE ... RENAME</code> 语句：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> RENAME </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> new_name;</span></span></code></pre></div><p>解释说明：</p><ul><li><code>name</code> 是要重命名的数据库的名字。</li><li><code>new_name</code> 是数据库的新名字。</li></ul><p>您不能重命名仍有活动连接的数据库，否则 PostgreSQL 将给出一个错误。</p><ul><li><p>如果您要重命名当前正在连接的数据库， PostgreSQL 将给出以下错误：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ERROR:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">current</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cannot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">be</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">renamed。</span></span></code></pre></div></li><li><p>如果您要重命名的数据库仍有活动连接，PostgreSQL 将给出以下错误：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ERROR:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testdb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">being</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">accessed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">other</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">users</span></span>
<span class="line"><span style="color:#FFCB6B;">DETAIL:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">There</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">other</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">session</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database.</span></span></code></pre></div></li></ul><h2 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-label="Permalink to &quot;实例&quot;">​</a></h2><p>在本实例中，我们将使用 psql 工具连接 PostgreSQL 服务器， <a href="/database/postgreSQL/databaseAndTable/创建数据库.html">创建一个数据库</a> <code>test_db</code> 并将它重命名为 <code>test_new_db</code>。</p><ol><li><p>首先，请使用具有权限的用户登录 PostgreSQL 服务器：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">~</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> psql -U postgres</span></span>
<span class="line"><span style="color:#FFCB6B;">psql</span><span style="color:#A6ACCD;"> (14.4)</span></span>
<span class="line"><span style="color:#FFCB6B;">Type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">help</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">help.</span></span></code></pre></div></li><li><p>其次，使用默认的选项创建 <code>test_db</code> 数据库：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_db</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span></span></code></pre></div><p>如果您输入了一个已经存在的数据库名称， PostgreSQL 将返回一个错误：<code>ERROR: database &quot;test_db&quot; already exists</code></p></li><li><p>然后，使用 <code>\\c</code> 命令切换到刚刚创建的 <code>test_db</code> 数据库:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">\\c test_db;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">You</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">are</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">now</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">connected</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test_db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">user</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">postgres</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.</span></span></code></pre></div></li><li><p>然后，尝试将 <code>test_db</code> 数据库重命名为 <code>test_new_db</code>：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> test_db RENAME </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> test_new_db;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ERROR:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">current</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cannot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">be</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">renamed</span></span></code></pre></div><p>也就是说，您不能重命名当前打开的数据库。</p></li><li><p>保持刚刚的会话，打开一个新的会话并登陆，然后尝试重命名 <code>test_db</code> 数据库：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> test_db RENAME </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> test_new_db;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ERROR:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">database</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test_db</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">being</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">accessed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">other</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">users</span></span>
<span class="line"><span style="color:#FFCB6B;">DETAIL:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">There</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">other</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">session</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">using</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">the</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">database.</span></span></code></pre></div><p>这里， PostgreSQL 报告了一个错误： 数据库 <code>test_db</code> 正在被其他用户访问。</p></li><li><p>关闭以前的会话，并回到这个会话，重新尝试重命名：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> test_db RENAME </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> test_new_db;</span></span></code></pre></div><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">DROP DATABASE</span></span></code></pre></div><p>此时， <code>test_db</code> 数据库已经被重命名为 <code>test_new_db</code>。</p></li></ol><h2 id="查看并关闭数据库的活动连接" tabindex="-1">查看并关闭数据库的活动连接 <a class="header-anchor" href="#查看并关闭数据库的活动连接" aria-label="Permalink to &quot;查看并关闭数据库的活动连接&quot;">​</a></h2><p>有时候，并不是我们自己连接了要重命名的数据库。我们可以从 <code>pg_stat_activity</code> 视图中查询数据库中的活动连接，如下：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">  pid,</span></span>
<span class="line"><span style="color:#A6ACCD;">  usename,</span></span>
<span class="line"><span style="color:#A6ACCD;">  application_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span></span>
<span class="line"><span style="color:#A6ACCD;">  pg_stat_activity</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span></span>
<span class="line"><span style="color:#A6ACCD;">  datname </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test_db</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pid</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">usename</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">application_name</span></span>
<span class="line"><span style="color:#FFCB6B;">------+----------+------------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">8777</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">postgres</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">psql</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">row</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>然后，使用 <code>pg_terminate_backend()</code> 函数结束刚刚返回的活动连接：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> pg_terminate_backend(</span><span style="color:#F78C6C;">8777</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pg_terminate_backend</span></span>
<span class="line"><span style="color:#FFCB6B;">----------------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">t</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">row</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>最后，使用 <code>ALTER DATABASE ... RENAME</code> 重命名数据库就可以了。</p><h2 id="结论" tabindex="-1">结论 <a class="header-anchor" href="#结论" aria-label="Permalink to &quot;结论&quot;">​</a></h2><p>PostgreSQL <code>ALTER DATABASE ... RENAME</code> 语句用来重命名数据库。 您不能重命名有活动连接的数据库。</p>`,26),e=[o];function t(c,r,C,A,y,i){return a(),l("div",null,e)}const b=s(p,[["render",t]]);export{D as __pageData,b as default};
