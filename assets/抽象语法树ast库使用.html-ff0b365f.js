import{_ as p,r as t,o,c,a as n,b as s,d as e,e as u}from"./app-1d655497.js";const l={},i=n("h1",{id:"抽象语法树-go-ast-库使用",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#抽象语法树-go-ast-库使用","aria-hidden":"true"},"#"),s(" 抽象语法树 go/ast 库使用")],-1),k=n("h2",{id:"推荐背景",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#推荐背景","aria-hidden":"true"},"#"),s(" 推荐背景")],-1),r=n("p",null,"Go 语言在编译过程中经过词法分析和语法分析之后，就到了抽象语法树的构建阶段，经历这一阶段之后，语句就真正组织成了程序代码。利用抽象语法树解析库，我们可以完成代码的自动化分析和自动化生成，因此通常用于做一些自动化的工具，例如 wire。",-1),d=n("code",null,"<Badge />",-1),m=u(`<h2 id="使用案例" tabindex="-1"><a class="header-anchor" href="#使用案例" aria-hidden="true">#</a> 使用案例</h2><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;go/ast&quot;</span>
    <span class="token string">&quot;go/parser&quot;</span>
    <span class="token string">&quot;go/token&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">var</span>  src <span class="token operator">=</span> <span class="token string">\`
	package main
	import &quot;fmt&quot;
	func main() {
    	fmt.Println(&quot;Hello, World!&quot;)
	}
\`</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fset <span class="token operator">:=</span> token<span class="token punctuation">.</span><span class="token function">NewFileSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// positions are relative to fset</span>
    f<span class="token punctuation">,</span> err <span class="token operator">:=</span> parser<span class="token punctuation">.</span><span class="token function">ParseFile</span><span class="token punctuation">(</span>fset<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Print the AST.</span>
    ast<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>fset<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>fset 是文件字符集用于定位 ast.Node 的文件位置</li><li>parser.ParserFile 的第二参数为文件名，第三参数为字符串，前者是待解析的文件路径，后者为待解析的字符串。前者优先级高于后者。第四参数为解析模式(可以使用”|“来结合多种解析模式)</li></ul><p>运行结果如下</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>     <span class="token number">0</span>  <span class="token operator">*</span>ast<span class="token punctuation">.</span>File <span class="token punctuation">{</span>
     <span class="token number">1</span>  <span class="token punctuation">.</span>  Package<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">1</span>
     <span class="token number">2</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
     <span class="token number">3</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">9</span>
     <span class="token number">4</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;main&quot;</span>
     <span class="token number">5</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
     <span class="token number">6</span>  <span class="token punctuation">.</span>  Decls<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Decl <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token number">7</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>GenDecl <span class="token punctuation">{</span>
     <span class="token number">8</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  TokPos<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token number">1</span>
     <span class="token number">9</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Tok<span class="token punctuation">:</span> <span class="token keyword">import</span>
    <span class="token number">10</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Lparen<span class="token punctuation">:</span> <span class="token operator">-</span>
    <span class="token number">11</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Specs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Spec <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">12</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>ImportSpec <span class="token punctuation">{</span>
    <span class="token number">13</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Path<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>BasicLit <span class="token punctuation">{</span>
    <span class="token number">14</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  ValuePos<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token number">8</span>
    <span class="token number">15</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Kind<span class="token punctuation">:</span> STRING
    <span class="token number">16</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Value<span class="token punctuation">:</span> <span class="token string">&quot;\\&quot;fmt\\&quot;&quot;</span>
    <span class="token number">17</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">18</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  EndPos<span class="token punctuation">:</span> <span class="token operator">-</span>
    <span class="token number">19</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">20</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">21</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Rparen<span class="token punctuation">:</span> <span class="token operator">-</span>
    <span class="token number">22</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">23</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">1</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>FuncDecl <span class="token punctuation">{</span>
    <span class="token number">24</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
    <span class="token number">25</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">6</span>
    <span class="token number">26</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;main&quot;</span>
    <span class="token number">27</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Obj<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Object <span class="token punctuation">{</span>
    <span class="token number">28</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Kind<span class="token punctuation">:</span> <span class="token keyword">func</span>
    <span class="token number">29</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;main&quot;</span>
    <span class="token number">30</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Decl<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token punctuation">(</span>obj @ <span class="token number">23</span><span class="token punctuation">)</span>
    <span class="token number">31</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">32</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">33</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Type<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>FuncType <span class="token punctuation">{</span>
    <span class="token number">34</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Func<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">1</span>
    <span class="token number">35</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Params<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>FieldList <span class="token punctuation">{</span>
    <span class="token number">36</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Opening<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">10</span>
    <span class="token number">37</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Closing<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">11</span>
    <span class="token number">38</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">39</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">40</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Body<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>BlockStmt <span class="token punctuation">{</span>
    <span class="token number">41</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Lbrace<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">13</span>
    <span class="token number">42</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  List<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Stmt <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">43</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>ExprStmt <span class="token punctuation">{</span>
    <span class="token number">44</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  X<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>CallExpr <span class="token punctuation">{</span>
    <span class="token number">45</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Fun<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>SelectorExpr <span class="token punctuation">{</span>
    <span class="token number">46</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  X<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
    <span class="token number">47</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">5</span>
    <span class="token number">48</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;fmt&quot;</span>
    <span class="token number">49</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">50</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Sel<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
    <span class="token number">51</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">9</span>
    <span class="token number">52</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;Println&quot;</span>
    <span class="token number">53</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">54</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">55</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Lparen<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">16</span>
    <span class="token number">56</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Expr <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">57</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>BasicLit <span class="token punctuation">{</span>
    <span class="token number">58</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  ValuePos<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">17</span>
    <span class="token number">59</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Kind<span class="token punctuation">:</span> STRING
    <span class="token number">60</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Value<span class="token punctuation">:</span> <span class="token string">&quot;\\&quot;Hello World!\\&quot;&quot;</span>
    <span class="token number">61</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">62</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">63</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Ellipsis<span class="token punctuation">:</span> <span class="token operator">-</span>
    <span class="token number">64</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Rparen<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">31</span>
    <span class="token number">65</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">66</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">67</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">68</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Rbrace<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">:</span><span class="token number">1</span>
    <span class="token number">69</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">70</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">71</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">72</span>  <span class="token punctuation">.</span>  Scope<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Scope <span class="token punctuation">{</span>
    <span class="token number">74</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Objects<span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>Object <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">74</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token operator">*</span><span class="token punctuation">(</span>obj @ <span class="token number">27</span><span class="token punctuation">)</span>
    <span class="token number">75</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">76</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">77</span>  <span class="token punctuation">.</span>  Imports<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>ImportSpec <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">78</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span><span class="token punctuation">(</span>obj @ <span class="token number">12</span><span class="token punctuation">)</span>
    <span class="token number">79</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">80</span>  <span class="token punctuation">.</span>  Unresolved<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token number">81</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span><span class="token punctuation">(</span>obj @ <span class="token number">46</span><span class="token punctuation">)</span>
    <span class="token number">82</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
    <span class="token number">83</span>  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ast-file-内容" tabindex="-1"><a class="header-anchor" href="#ast-file-内容" aria-hidden="true">#</a> ast.File 内容</h2><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> File <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Doc        <span class="token operator">*</span>CommentGroup   <span class="token comment">// associated documentation; or nil</span>
	Package    token<span class="token punctuation">.</span>Pos       <span class="token comment">// position of &quot;package&quot; keyword</span>
	Name       <span class="token operator">*</span>Ident          <span class="token comment">// package name</span>
	Decls      <span class="token punctuation">[</span><span class="token punctuation">]</span>Decl          <span class="token comment">// top-level declarations; or nil</span>
	Scope      <span class="token operator">*</span>Scope          <span class="token comment">// package scope (this file only)</span>
	Imports    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>ImportSpec   <span class="token comment">// imports in this file</span>
	Unresolved <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Ident        <span class="token comment">// unresolved identifiers in this file</span>
	Comments   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>CommentGroup <span class="token comment">// list of all comments in the source file</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 Decls 成员表示的就是文件中的顶级声明。接下来我们主要是关注它的内容。</p><h3 id="包声明" tabindex="-1"><a class="header-anchor" href="#包声明" aria-hidden="true">#</a> 包声明</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>  Package<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">1</span>
  Name<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">9</span>
  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;main&quot;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应文件中的 “package main”语句，记录了语句的位置以及包名(main)字符串的位置信息。</p><h3 id="引入声明" tabindex="-1"><a class="header-anchor" href="#引入声明" aria-hidden="true">#</a> 引入声明</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>	<span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>GenDecl <span class="token punctuation">{</span>
 <span class="token punctuation">.</span>  TokPos<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token number">1</span>
 <span class="token punctuation">.</span>  Tok<span class="token punctuation">:</span> <span class="token keyword">import</span>
 <span class="token punctuation">.</span>  Lparen<span class="token punctuation">:</span> <span class="token operator">-</span>
 <span class="token punctuation">.</span>  Specs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Spec <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>ImportSpec <span class="token punctuation">{</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Path<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>BasicLit <span class="token punctuation">{</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  ValuePos<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token number">8</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Kind<span class="token punctuation">:</span> STRING
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Value<span class="token punctuation">:</span> <span class="token string">&quot;\\&quot;fmt\\&quot;&quot;</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  EndPos<span class="token punctuation">:</span> <span class="token operator">-</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
 <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
 <span class="token punctuation">.</span>  Rparen<span class="token punctuation">:</span> <span class="token operator">-</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 ast.GenDecl 中记录了 import 语句的位置信息。Specs 为一个 ast.Spec 的数组，记录了每一个 import 的包名及位置信息。</p><h3 id="函数声明" tabindex="-1"><a class="header-anchor" href="#函数声明" aria-hidden="true">#</a> 函数声明</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>	<span class="token operator">*</span>ast<span class="token punctuation">.</span>FuncDecl<span class="token punctuation">{</span>
		Name<span class="token punctuation">:</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>Index<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
		Type<span class="token punctuation">:</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>FuncType<span class="token punctuation">{</span>
			Params<span class="token punctuation">:</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>FieldList<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
			Results<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>FieldList<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		Body<span class="token punctuation">:</span><span class="token operator">*</span>ast<span class="token punctuation">.</span>BlockStmt<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ast.FuncDecl 标明定义的是一个函数。</li><li>Name 记录函数名</li><li>Type 是函数类型,其中 Params 表示参数信息，这里为空；Results 表示返回值信息，这里也为空。</li><li>Body 则为函数体信息。</li></ul><h3 id="表达式" tabindex="-1"><a class="header-anchor" href="#表达式" aria-hidden="true">#</a> 表达式</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>List<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Stmt <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>ExprStmt <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  X<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>CallExpr <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Fun<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>SelectorExpr <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  X<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">5</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Sel<span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  NamePos<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">9</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Name<span class="token punctuation">:</span> <span class="token string">&quot;Println&quot;</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Lparen<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">16</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>ast<span class="token punctuation">.</span>Expr <span class="token punctuation">(</span><span class="token builtin">len</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>BasicLit <span class="token punctuation">{</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  ValuePos<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">17</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Kind<span class="token punctuation">:</span> STRING
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Value<span class="token punctuation">:</span> &quot;\\&quot;Hello Wor
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Ellipsis<span class="token punctuation">:</span> <span class="token operator">-</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">.</span>  Rparen<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">31</span>
<span class="token punctuation">.</span>  <span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Rbrace<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">:</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>函数体中的表达式描述了函数的内容，例子中的 fmt.Println(“hello world”)。</p><p>ast.CallExpr 表示函数调用，其中 SelectorExpr 描述了调用函数的包名及函数名，Args 则描述了参数信息。</p><h2 id="遍历-ast-树" tabindex="-1"><a class="header-anchor" href="#遍历-ast-树" aria-hidden="true">#</a> 遍历 AST 树</h2><p>ast 库提供了可以深度优先遍历 AST 的方法：func Inspect(node Node, f func(Node) bool)。 其中 node 为根节点，f 为处理节点的方法。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>ast<span class="token punctuation">.</span><span class="token function">Inspect</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>n ast<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> s <span class="token builtin">string</span>
		<span class="token keyword">switch</span> x <span class="token operator">:=</span> n<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>BasicLit<span class="token punctuation">:</span>
			s <span class="token operator">=</span> x<span class="token punctuation">.</span>Value
		<span class="token keyword">case</span> <span class="token operator">*</span>ast<span class="token punctuation">.</span>Ident<span class="token punctuation">:</span>
			s <span class="token operator">=</span> x<span class="token punctuation">.</span>Name
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> s <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s:\\t%s\\n&quot;</span><span class="token punctuation">,</span> fset<span class="token punctuation">.</span><span class="token function">Position</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">Pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此函数遍历 f(ast.File)节点打印所有的标识符和文字。</p><p>更多相关类型，可以通过命令</p><p>go doc ast |grep &quot;^type .* struct&quot;</p><p>查看。</p><h2 id="进阶使用" tabindex="-1"><a class="header-anchor" href="#进阶使用" aria-hidden="true">#</a> 进阶使用</h2><p>利用 AST 对 go 文件进行分析，我们可以实现代码的自动生成，其中包括以下几个常见使用领域：</p><ol><li>代码注入: wire 使用 AST 实现构造函数代码生成。</li><li>DeepCopy: 结合 AST 生成结构体的深拷贝函数代码</li><li>对象赋值: 在领域编程中，常常需要在不同的领域对象中进行数据转换，利用 AST 的解析结果，可以自动生成指定领域对象间的转换函数文件。</li></ol><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h2><p>抽象语法树的生成属于程序编译流程中的一员，利用 AST 及其相关库提供到方法，我们可以很方便的解析一个 go 文件，把文件内容结构化，以便做进一步的分析和使用。AST 广泛应用于代码自动生成的功能中，例如</p><p>go generate</p><p>命令，wire 工具等等。其中不少企业也会在开源库中，使用 Comment 的特殊格式，来自定义框架代码的自动生成命令。</p>`,35);function v(b,g){const a=t("Badge");return o(),c("div",null,[i,k,r,n("p",null,[s("这是默认主题内置的 "),d,s(" 组件 "),e(a,{text:"演示"})]),m])}const f=p(l,[["render",v],["__file","抽象语法树ast库使用.html.vue"]]);export{f as default};
